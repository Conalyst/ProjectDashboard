import { BaseRepository } from "../contracts/BaseRepository"
import { Model } from "sequelize-typescript";
import db from '../db/models'
const AssetVulnerability = require("../db/models")

export class AssetVulnerabilityRepository {
    constructor(){
         
    }

    public async GetByAssetId(AssetId: number){
      let vulnerabilities = await db.AssetVulnerability.findAll({
        where: {assetId: `${AssetId}`},
        include: [
          {
            model: db.Asset,
            attributes: ['id', 'title', 'description']
          }, 
          {
            model: db.Vulnerability,
            attributes: ['id', 'category','title', 'description']
          }
        ],
        attributes: ['id', 'assetId', 'vulnerabilityId']
        // include: { all: true, nested: true }
      })
        return vulnerabilities;      
    }   

    public async GetByVulnetabilityId(vulnerabilityId: number){
      let vulnerabilities = await db.AssetVulnerability.findAll({
        where: {vulnerabilityId: `${vulnerabilityId}`},
        include: [
                  {
                    model: db.Asset,
                    attributes: ['id', 'title', 'description']
                  }, 
                  {
                    model: db.Vulnerability,
                    attributes: ['id', 'category','title', 'description']
                  }
                ],
        attributes: ['id', 'assetId', 'vulnerabilityId']
        // include: { all: true, nested: true }
      })
        return vulnerabilities;      
    }   
    
    public async GetByAssetVulnetabilityIds(vulnerabilityId: number, assetId: number){
      let results = await db.AssetVulnerability.findOne({
        where: {vulnerabilityId: `${vulnerabilityId}` , assetId: `${assetId}`}
      })
        return results;      
    }   

    public async Create(model: Model<typeof AssetVulnerability>){
      return db.AssetVulnerability.create(model['dataValues']);
    }

}