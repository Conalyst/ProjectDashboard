import { BaseRepository } from "../contracts/BaseRepository"
import { Model } from "sequelize-typescript";
import db from '../db/models'
const VulnerabilityThreat = require("../db/models")

export class VulnerabilityThreatRepository {
    constructor(){
         
    }

    public async GetByThreatId(ThreatId: number){
      let threats = await db.VulnerabilityThreat.findAll({
        where: {ThreatId: `${ThreatId}`},
        include: [
          {
            model: db.Threat,
            attributes: ['id', 'category', 'agent', 'title', 'description']
          }, 
          {
            model: db.Vulnerability,
            attributes: ['id','title', 'description']
          }
        ],
        attributes: ['id', 'threatId', 'vulnerabilityId']
        // include: { all: true, nested: true }
      })
        return threats;      
    }   
    
    public async GetByVulnetabilityId(vulnerabilityId: number){
      let vulnerabilities = await db.VulnerabilityThreat.findAll({
        where: {vulnerabilityId: `${vulnerabilityId}`},
        include: [
                  {
                    model: db.Threat,
                    attributes: ['id', 'category', 'agent', 'title', 'description']
                  }, 
                  {
                    model: db.Vulnerability,
                    attributes: ['id','title', 'description']
                  }
                ],
        attributes: ['id', 'threatId', 'vulnerabilityId']
        // include: { all: true, nested: true }
      })
        return vulnerabilities;      
    }   

    public async GetByVulnetabilityThreatIds(vulnerabilityId: number, threatId: number){
      let results = await db.VulnerabilityThreat.findOne({
        where: {vulnerabilityId: `${vulnerabilityId}` , threatId: `${threatId}`}
      })
        return results;      
    }   

    public async Create(model: Model<typeof VulnerabilityThreat>){
      return db.VulnerabilityThreat.create(model['dataValues']);
    }
    
}